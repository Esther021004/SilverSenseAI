<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SilverSense AI - ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            padding: 20px 40px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn.active {
            background: #667eea;
            color: white;
        }

        .diagram-container {
            padding: 40px;
            background: white;
            overflow-x: auto;
            min-height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .diagram-wrapper {
            width: 100%;
            text-align: center;
        }

        .diagram-wrapper svg {
            max-width: 100%;
            height: auto;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #e74c3c;
            font-size: 1.1em;
        }

        .info-box {
            margin: 20px 40px;
            padding: 20px;
            background: #f0f7ff;
            border-left: 4px solid #667eea;
            border-radius: 8px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #555;
            line-height: 1.6;
        }

        .footer {
            padding: 20px 40px;
            background: #f8f9fa;
            text-align: center;
            color: #666;
            border-top: 1px solid #e0e0e0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .controls {
                padding: 15px 20px;
            }

            .diagram-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ SilverSense AI</h1>
            <p>ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨</p>
        </div>

        <div class="controls">
            <button class="btn active" onclick="showDiagram('full')">ì „ì²´ ì•„í‚¤í…ì²˜</button>
            <button class="btn" onclick="showDiagram('simple')">ê°„ë‹¨ ë²„ì „</button>
            <button class="btn" onclick="showDiagram('pipeline')">íŒŒì´í”„ë¼ì¸</button>
            <button class="btn" onclick="downloadDiagram()">ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <div class="info-box">
            <h3>ğŸ’¡ ì‚¬ìš© ë°©ë²•</h3>
            <p>
                â€¢ ë‹¤ì´ì–´ê·¸ë¨ì„ í™•ëŒ€/ì¶•ì†Œí•˜ë ¤ë©´ ë§ˆìš°ìŠ¤ íœ ì„ ì‚¬ìš©í•˜ì„¸ìš”<br>
                â€¢ ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ë¡œë“œí•˜ë ¤ë©´ "ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”<br>
                â€¢ ë°œí‘œìë£Œì— ë§í¬ë¡œ ê³µìœ í•˜ê±°ë‚˜, ì „ì²´í™”ë©´ìœ¼ë¡œ ë³´ì—¬ì£¼ì„¸ìš”
            </p>
        </div>

        <div class="diagram-container">
            <div class="diagram-wrapper" id="diagram-wrapper">
                <div class="loading">ë‹¤ì´ì–´ê·¸ë¨ì„ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...</div>
            </div>
        </div>

        <div class="footer">
            <p>SilverSense AI - Emergency Assistant System Architecture</p>
        </div>
    </div>

    <script>
        // Mermaid ì´ˆê¸°í™”
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#e1f5ff',
                primaryTextColor: '#01579b',
                primaryBorderColor: '#01579b',
                lineColor: '#667eea',
                secondaryColor: '#fff4e1',
                tertiaryColor: '#ffe1f5'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // ë‹¤ì´ì–´ê·¸ë¨ ì •ì˜
        const diagrams = {
            full: `graph TB
    subgraph "ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤"
        UI[ì›¹ ë¸Œë¼ìš°ì €<br/>silversense_ai.html]
        TTS[Text-to-Speech<br/>Web Speech API]
        STT_IN[Speech-to-Text<br/>Web Speech API]
    end
    
    subgraph "FastAPI ì„œë²„"
        API[main.py]
        EP1[POST /api/emergency/analyze-video]
        EP2[POST /api/emergency/ask]
    end
    
    subgraph "ì „ì²˜ë¦¬"
        FILE[íŒŒì¼ ì—…ë¡œë“œ<br/>mp4/wav/mp3]
        EXTRACT[ì˜¤ë””ì˜¤ ì¶”ì¶œ<br/>MoviePy]
        AUDIO[ì˜¤ë””ì˜¤ íŒŒì¼<br/>wav]
    end
    
    subgraph "Module A - Speech Analysis"
        STT[STT<br/>Whisper]
        A[ìŒì„± ë¶„ì„<br/>module_a_speech.py]
        INTENT[Intent ë¶„ë¥˜<br/>intent_rules.py]
        SPEECH_RESULT[Speech Result<br/>disaster_large, urgency_level ë“±]
    end
    
    subgraph "Module B - Sound Analysis"
        B[ì‚¬ìš´ë“œ ë¶„ì„<br/>module_b_sound.py]
        CNN[CNN ëª¨ë¸<br/>PyTorch]
        SOUND_RESULT[Sound Result<br/>event, confidence]
    end
    
    subgraph "Module C - Fusion"
        C[ìƒí™© ìœµí•©<br/>module_c_fusion.py]
        GEMINI_FUSION[Gemini API<br/>gemini-flash-lite-latest]
        SITUATION[Situation JSON<br/>S0~S7, emergency_level]
    end
    
    subgraph "RAG System"
        RAG_CLIENT[rag_client.py]
        RAG_SYS[rag_system.py]
        VECTOR[ChromaDB<br/>ë²¡í„° ìŠ¤í† ì–´]
        EMBED[ì„ë² ë”©<br/>ko-sroberta-multitask]
        DOCS[PDF ë¬¸ì„œ<br/>ì‘ê¸‰ì²˜ì¹˜ ë§¤ë‰´ì–¼]
        GEMINI_RAG[Gemini API<br/>gemini-2.0-flash]
        GUIDELINE[ë§ì¶¤ ì§€ì¹¨<br/>ë‹¨ê³„ë³„ ì•ˆë‚´]
    end
    
    subgraph "Conversational AI"
        QA[ì§ˆë¬¸ ì²˜ë¦¬<br/>/api/emergency/ask]
        GEMINI_QA[Gemini API<br/>gemini-2.0-flash]
        ANSWER[ìƒí™© ê¸°ë°˜ ë‹µë³€]
    end
    
    UI -->|íŒŒì¼ ì—…ë¡œë“œ| EP1
    UI -->|ìŒì„±/í…ìŠ¤íŠ¸ ì§ˆë¬¸| EP2
    EP1 --> FILE
    FILE --> EXTRACT
    EXTRACT --> AUDIO
    AUDIO --> STT
    AUDIO --> B
    STT --> A
    A --> INTENT
    INTENT --> SPEECH_RESULT
    B --> CNN
    CNN --> SOUND_RESULT
    SPEECH_RESULT --> C
    SOUND_RESULT --> C
    C --> GEMINI_FUSION
    GEMINI_FUSION --> SITUATION
    SITUATION --> RAG_CLIENT
    RAG_CLIENT --> RAG_SYS
    RAG_SYS --> VECTOR
    VECTOR --> EMBED
    VECTOR --> DOCS
    RAG_SYS --> GEMINI_RAG
    GEMINI_RAG --> GUIDELINE
    GUIDELINE --> UI
    EP2 --> QA
    QA --> GEMINI_QA
    GEMINI_QA --> ANSWER
    ANSWER --> UI
    UI --> TTS
    
    style UI fill:#e1f5ff,stroke:#01579b
    style API fill:#fff4e1,stroke:#e65100
    style C fill:#ffe1f5,stroke:#880e4f
    style RAG_SYS fill:#e1ffe1,stroke:#1b5e20
    style GEMINI_FUSION fill:#f5e1ff,stroke:#4a148c
    style GEMINI_RAG fill:#f5e1ff,stroke:#4a148c
    style GEMINI_QA fill:#f5e1ff,stroke:#4a148c`,

            simple: `graph LR
    A[ğŸ“ íŒŒì¼ ì—…ë¡œë“œ<br/>ìŒì„±/ì˜ìƒ] --> B[ğŸ¤ STT<br/>Whisper]
    A --> C[ğŸ”Š ì‚¬ìš´ë“œ ë¶„ì„<br/>CNN ëª¨ë¸]
    B --> D[ğŸ“ Module A<br/>ìŒì„± ë¶„ì„]
    C --> E[ğŸ“Š Module B<br/>ì‚¬ìš´ë“œ ë¶„ì„]
    D --> F[ğŸ§  Module C<br/>ìƒí™© ìœµí•©<br/>Gemini API]
    E --> F
    F --> G[ğŸ“š RAG ì‹œìŠ¤í…œ<br/>ì§€ì¹¨ ìƒì„±<br/>Gemini API]
    G --> H[ğŸ’¬ ëŒ€í™”í˜• AI<br/>ì§ˆë¬¸-ë‹µë³€<br/>Gemini API]
    G --> I[ğŸ“± ì‚¬ìš©ì<br/>ì§€ì¹¨ ì œê³µ]
    H --> I
    
    style A fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style B fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style C fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style D fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    style E fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    style F fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style G fill:#e8f5e9,stroke:#388e3c,stroke-width:3px
    style H fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    style I fill:#fff9c4,stroke:#f9a825,stroke-width:3px`,

            pipeline: `flowchart TD
    START[ğŸ“ íŒŒì¼ ì—…ë¡œë“œ<br/>mp4 / wav / mp3] --> EXTRACT[ğŸµ ì˜¤ë””ì˜¤ ì¶”ì¶œ<br/>MoviePy]
    
    EXTRACT --> STT[ğŸ¤ STT<br/>Whisper<br/>ìŒì„± â†’ í…ìŠ¤íŠ¸]
    EXTRACT --> SOUND[ğŸ”Š ì‚¬ìš´ë“œ ë¶„ì„<br/>PyTorch CNN<br/>ì´ë²¤íŠ¸ ê°ì§€]
    
    STT --> A[ğŸ“ Module A<br/>ìŒì„± ë¶„ì„<br/>ì¬ë‚œ ìœ í˜•, ê¸´ê¸‰ë„]
    SOUND --> B[ğŸ“Š Module B<br/>ì‚¬ìš´ë“œ ë¶„ì„<br/>ë‚™ìƒ/í™”ì¬/ê°‡í˜]
    
    A --> C[ğŸ§  Module C<br/>ìƒí™© ìœµí•©<br/>Gemini API]
    B --> C
    
    C --> SITUATION[ğŸ“‹ Situation JSON<br/>S0~S7<br/>ê¸´ê¸‰ë„ íŒë‹¨]
    
    SITUATION --> RAG[ğŸ“š RAG ì‹œìŠ¤í…œ<br/>ë¬¸ì„œ ê²€ìƒ‰ + ìƒì„±<br/>ChromaDB + Gemini]
    
    RAG --> GUIDELINE[âœ… ë§ì¶¤ ì§€ì¹¨<br/>ë‹¨ê³„ë³„ ì•ˆë‚´]
    
    GUIDELINE --> USER[ğŸ‘¤ ì‚¬ìš©ì<br/>ì§€ì¹¨ ì œê³µ + TTS]
    
    SITUATION --> QA[ğŸ’¬ ì§ˆë¬¸-ë‹µë³€<br/>Gemini API]
    QA --> USER
    
    style START fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style STT fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style SOUND fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style A fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    style B fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    style C fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style SITUATION fill:#e1bee7,stroke:#8e24aa,stroke-width:2px
    style RAG fill:#e8f5e9,stroke:#388e3c,stroke-width:3px
    style GUIDELINE fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    style QA fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    style USER fill:#fff9c4,stroke:#f9a825,stroke-width:3px`
        };

        let currentDiagram = 'full';
        let currentSvg = null;

        // ë‹¤ì´ì–´ê·¸ë¨ ë Œë”ë§ í•¨ìˆ˜
        async function renderDiagram(type) {
            const wrapper = document.getElementById('diagram-wrapper');
            wrapper.innerHTML = '<div class="loading">ë‹¤ì´ì–´ê·¸ë¨ì„ ë Œë”ë§ ì¤‘ì…ë‹ˆë‹¤...</div>';

            try {
                const { svg } = await mermaid.render(`diagram-${type}`, diagrams[type]);
                wrapper.innerHTML = svg;
                currentSvg = svg;
                currentDiagram = type;

                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                document.querySelectorAll('.btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
            } catch (error) {
                wrapper.innerHTML = `<div class="error">ë‹¤ì´ì–´ê·¸ë¨ ë Œë”ë§ ì˜¤ë¥˜: ${error.message}</div>`;
                console.error('Mermaid ë Œë”ë§ ì˜¤ë¥˜:', error);
            }
        }

        // ë‹¤ì´ì–´ê·¸ë¨ í‘œì‹œ í•¨ìˆ˜
        function showDiagram(type) {
            renderDiagram(type);
        }

        // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        function downloadDiagram() {
            if (!currentSvg) {
                alert('ë‹¤ì´ì–´ê·¸ë¨ì„ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                // SVGë¥¼ Canvasë¡œ ë³€í™˜
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                const svgBlob = new Blob([currentSvg], { type: 'image/svg+xml;charset=utf-8' });
                const url = URL.createObjectURL(svgBlob);

                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    canvas.toBlob(function(blob) {
                        const link = document.createElement('a');
                        link.download = `silversense-architecture-${currentDiagram}.png`;
                        link.href = URL.createObjectURL(blob);
                        link.click();
                        URL.revokeObjectURL(url);
                        URL.revokeObjectURL(link.href);
                    });
                };

                img.onerror = function() {
                    // SVG ì§ì ‘ ë‹¤ìš´ë¡œë“œ
                    const link = document.createElement('a');
                    link.download = `silversense-architecture-${currentDiagram}.svg`;
                    link.href = url;
                    link.click();
                    setTimeout(() => URL.revokeObjectURL(url), 100);
                };

                img.src = url;
            } catch (error) {
                console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. SVGë¡œ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œë„í•©ë‹ˆë‹¤.');
                
                // SVG ì§ì ‘ ë‹¤ìš´ë¡œë“œ
                const blob = new Blob([currentSvg], { type: 'image/svg+xml;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.download = `silversense-architecture-${currentDiagram}.svg`;
                link.href = url;
                link.click();
                setTimeout(() => URL.revokeObjectURL(url), 100);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²« ë²ˆì§¸ ë‹¤ì´ì–´ê·¸ë¨ ë Œë”ë§
        window.addEventListener('load', () => {
            renderDiagram('full');
        });
    </script>
</body>
</html>

